# 自动安装环境 - 使用指南

## 🎯 新功能：自动检测并安装开发环境

现在即使是全新安装的电脑，也能自动安装所有必需的软件！

---

## 📁 新增文件

| 文件 | 功能 | 推荐度 | 适用场景 |
|------|------|--------|----------|
| **start-auto.bat** | 自动安装+启动 | ⭐⭐⭐⭐⭐ | 没有开发环境的电脑 |
| **start-auto.ps1** | 自动安装+启动（PowerShell） | ⭐⭐⭐⭐⭐ | 需要更好的错误处理 |
| **check-env.bat** | 环境检测工具 | ⭐⭐⭐⭐ | 检查缺少什么 |
| **start.bat** | 快速启动（需环境） | ⭐⭐⭐⭐ | 已有开发环境 |
| **stop.bat** | 停止服务 | ⭐⭐⭐⭐⭐ | 通用 |
| **status.bat** | 服务状态 | ⭐⭐⭐⭐ | 检查运行状态 |

---

## 🚀 使用方法

### 场景 1：全新电脑（没有 Node.js 和 Python）

#### 方式 A：批处理自动安装（推荐）

1. **双击 `start-auto.bat`**
2. 脚本会自动检测环境
3. 如果缺少软件，会询问是否安装
4. 选择 `Y` 自动下载并安装
5. 安装完成后自动启动服务

**特点：**
- ✅ 自动下载 Node.js v20.11.0
- ✅ 自动下载 Python 3.12.0
- ✅ 静默安装（无界面干扰）
- ✅ 自动配置环境变量
- ✅ 安装后自动启动应用

#### 方式 B：PowerShell 自动安装（更强大）

1. **右键点击 `start-auto.ps1`**
2. 选择 "使用 PowerShell 运行"
3. 脚本会自动检测环境
4. 缺少软件时会询问
5. 自动下载、安装、启动

**优势：**
- 🎨 彩色输出，更直观
- 📊 进度提示
- 🔍 更好的错误检测
- 💾 自动清理临时文件
- ⚡ 更快的响应速度

---

### 场景 2：已有开发环境

直接双击 `start.bat` 快速启动（跳过环境检测）

---

### 场景 3：不确定是否有环境

1. **双击 `check-env.bat`**
2. 查看检测结果
3. 根据提示选择：
   - 自动安装（推荐）
   - 手动安装
   - 启动应用

---

## 📋 自动安装流程

### start-auto.bat 流程图

```
双击启动
  ↓
检测 Node.js
  ├─ 已安装 → 检查版本
  │    └─ 版本过旧 → 询问是否升级
  └─ 未安装 → 询问是否安装
       ├─ 是 → 下载 Node.js 安装包
       │       ├─ 静默安装
       │       ├─ 配置环境变量
       │       └─ 验证安装
       └─ 否 → 提示手动安装 → 退出
  ↓
检测 Python
  ├─ 已安装 → 检查版本
  └─ 未安装 → 询问是否安装
       ├─ 是 → 下载 Python 安装包
       │       ├─ 静默安装（添加到 PATH）
       │       └─ 验证安装
       └─ 否 → 提示手动安装 → 退出
  ↓
清理端口占用
  ├─ 关闭端口 3000 的进程
  └─ 关闭端口 8080 的进程
  ↓
安装依赖
  ├─ node_modules 存在 → 跳过
  └─ 不存在 → npm install
  ↓
启动服务
  ├─ 启动后端（端口 3000）
  ├─ 等待 5 秒
  ├─ 启动前端（端口 8080）
  ├─ 等待 2 秒
  └─ 打开浏览器
  ↓
成功！
```

---

## 💾 下载详情

### Node.js
- **版本**: v20.11.0 (LTS)
- **大小**: 约 30 MB
- **下载源**: https://nodejs.org/
- **安装时间**: 1-2 分钟
- **安装位置**: `C:\Program Files\nodejs\`

### Python
- **版本**: 3.12.0
- **大小**: 约 25 MB
- **下载源**: https://www.python.org/
- **安装时间**: 1-2 分钟
- **安装位置**: `C:\Program Files\Python312\`
- **PATH 配置**: 自动添加到系统 PATH

---

## ⚙️ 安装选项

### 静默安装参数

**Node.js:**
```batch
msiexec /i node-installer.msi /quiet /norestart
```

**Python:**
```batch
python-installer.exe /quiet InstallAllUsers=1 PrependPath=1
```

### 说明
- `/quiet` - 无用户界面，后台安装
- `/norestart` - 安装后不重启
- `InstallAllUsers=1` - 为所有用户安装
- `PrependPath=1` - 添加到 PATH 前面

---

## 🔧 故障排除

### 问题 1：安装后提示需要重启

**原因**: 环境变量需要重启才能生效

**解决方案**:
1. 保存当前工作
2. 重启电脑
3. 再次运行 `start-auto.bat`

### 问题 2：下载失败

**原因**: 网络问题或防火墙阻止

**解决方案**:
1. 检查网络连接
2. 暂时关闭防火墙
3. 或手动下载安装包：
   - Node.js: https://nodejs.org/
   - Python: https://www.python.org/

### 问题 3：权限不足

**原因**: 需要管理员权限安装软件

**解决方案**:
1. 右键点击脚本
2. 选择 "以管理员身份运行"

### 问题 4：安装后找不到命令

**原因**: PATH 环境变量未更新

**解决方案**:
```batch
# 手动刷新环境变量
refreshenv

# 或重启电脑
# 或重新打开命令行窗口
```

### 问题 5：PowerShell 脚本无法运行

**原因**: 执行策略限制

**解决方案**:
```powershell
# 修改执行策略
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser

# 或右键文件 → 属性 → 解锁
```

---

## 📊 对比：各种启动方式

| 特性 | start.bat | start-auto.bat | start-auto.ps1 |
|------|-----------|----------------|----------------|
| **环境检测** | ❌ | ✅ | ✅ |
| **自动安装** | ❌ | ✅ | ✅ |
| **彩色输出** | ❌ | ❌ | ✅ |
| **进度提示** | 基础 | 基础 | 详细 |
| **错误处理** | 基础 | 基础 | 高级 |
| **自动清理** | ❌ | ✅ | ✅ |
| **下载进度** | ❌ | ❌ | ✅ |
| **管理员检测** | ❌ | ✅ | ✅ |
| **适用场景** | 有环境 | 无环境 | 无环境 |

---

## 🎯 推荐使用流程

### 首次使用（无环境）

```
1. 右键 start-auto.ps1
   ↓
2. 选择 "以管理员身份运行"
   ↓
3. 选择 Y 安装 Node.js
   ↓
4. 等待安装完成（约 2 分钟）
   ↓
5. 选择 Y 安装 Python
   ↓
6. 等待安装完成（约 2 分钟）
   ↓
7. 如提示重启，重启电脑
   ↓
8. 再次运行 start-auto.ps1
   ↓
9. 自动启动应用 ✅
```

### 日常使用（已有环境）

```
1. 双击 start.bat
   ↓
2. 等待 10 秒
   ↓
3. 自动打开浏览器 ✅
```

---

## 💡 最佳实践

### 1. 首次安装
- 使用管理员权限运行
- 确保网络连接稳定
- 准备好 5-10 分钟时间
- 可能需要重启一次

### 2. 日常使用
- 直接使用 `start.bat`
- 无需管理员权限
- 10 秒内完成启动

### 3. 维护
- 定期运行 `check-env.bat` 检查环境
- 定期运行 `status.bat` 检查服务
- 不需要时运行 `stop.bat` 停止服务

---

## 🔒 安全说明

### 下载来源
- **Node.js**: 官方网站 https://nodejs.org/
- **Python**: 官方网站 https://www.python.org/
- **验证**: 所有安装包都从官方源下载

### 安装位置
- **Node.js**: `C:\Program Files\nodejs\`
- **Python**: `C:\Program Files\Python312\`
- **依赖**: `backend\node_modules\`

### 权限要求
- 安装软件需要管理员权限
- 启动服务不需要管理员权限
- 确保从可信来源下载

---

## 📖 相关文档

- `README_START.md` - 快速开始指南
- `START_GUIDE.md` - 详细使用指南（中文）
- `SCRIPTS_SUMMARY.md` - 脚本功能详解

---

## ✅ 功能验证

安装完成后，验证所有组件：

```batch
# 1. 验证 Node.js
node --version
# 输出: v20.11.0

# 2. 验证 Python
python --version
# 输出: Python 3.12.0

# 3. 验证后端
访问: http://localhost:3000/api/health

# 4. 验证前端
访问: http://127.0.0.1:8080/index-vue.html
```

---

## 🎉 总结

现在你有**3 种启动方式**：

1. **start-auto.bat/ps1** - 全自动（适合新电脑）
2. **check-env.bat** - 检测环境（不确定时）
3. **start.bat** - 快速启动（已有环境）

**选择合适的脚本，享受一键启动的便利！** 🚀
