<!--pages/index/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æœç´¢æ  -->
  <view class="search-section">
    <view class="search-bar">
      <input class="search-input"
             placeholder="æœç´¢è¡Œä¸šï¼šçººç»‡ã€ç”µå­ã€æœºæ¢°..."
             bindconfirm="onSearch"
             value="{{searchKeyword}}" />
      <text class="search-btn" bindtap="onSearch">ğŸ”</text>
    </view>
  </view>

  <!-- è¡Œä¸šå¿«æ·é€‰æ‹© -->
  <view class="industry-section">
    <view class="section-title">
      <text>ğŸ­ é€‰æ‹©è¡Œä¸š</text>
    </view>
    <scroll-view scroll-x class="industry-scroll">
      <view class="industry-item {{currentIndustry === item.id ? 'active' : ''}}"
            wx:for="{{industries}}"
            wx:key="id"
            bindtap="selectIndustry"
            data-id="{{item.id}}">
        <text class="icon">{{item.icon}}</text>
        <text class="name">{{item.name}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- åœ°åŒºç­›é€‰ -->
  <view class="region-filter" wx:if="{{currentIndustry}}">
    <view class="region-item {{!currentRegion ? 'active' : ''}}"
          bindtap="selectRegion"
          data-region="">
      å…¨éƒ¨åœ°åŒº
    </view>
    <view class="region-item {{currentRegion === item.id ? 'active' : ''}}"
          wx:for="{{regions}}"
          wx:key="id"
          bindtap="selectRegion"
          data-region="{{item.id}}">
      {{item.flag}} {{item.name}}
    </view>
  </view>

  <!-- æ•°æ®æ¦‚è§ˆï¼ˆæ–°å®¢æˆ·ç­¾å•ç”¨ï¼‰ -->
  <view class="overview-section card" wx:if="{{overview && currentIndustry}}">
    <view class="section-title">
      <text>ğŸ“Š {{currentIndustryName}}å‡ºå£æ¦‚å†µ</text>
    </view>
    <view class="overview-grid">
      <view class="overview-item"
            wx:for="{{overviewData}}"
            wx:key="region">
        <text class="region-name">{{item.region}}</text>
        <view class="region-stats">
          <view class="stat-row">
            <text class="label">å·¥å‚æ•°</text>
            <text class="value">{{item.totalFactories}}</text>
          </view>
          <view class="stat-row">
            <text class="label">æ’­æ”¾é‡</text>
            <text class="value">{{formatNumber(item.totalViews)}}</text>
          </view>
          <view class="stat-row">
            <text class="label">è¯¢ç›˜æ•°</text>
            <text class="value">{{formatNumber(item.totalInquiries)}}</text>
          </view>
        </view>
        <view class="recommendation {{item.recommendationClass}}">
          <text>{{item.recommendation}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- çˆ†æ¬¾äº§å“æ¨è -->
  <view class="hot-products-section" wx:if="{{hotProducts.length > 0}}">
    <view class="section-title">
      <text>ğŸ”¥ è¡Œä¸šçˆ†æ¬¾äº§å“</text>
    </view>
    <scroll-view scroll-x class="products-scroll">
      <view class="product-item card"
            wx:for="{{hotProducts}}"
            wx:key="name">
        <image class="product-image" src="{{item.image || '/images/product-placeholder.png'}}" mode="aspectFill" />
        <view class="product-info">
          <text class="product-name">{{item.name}}</text>
          <text class="product-price">{{item.price}}</text>
          <text class="product-factory">{{item.factoryName}}</text>
          <view class="product-stats">
            <text>ğŸ‘ {{formatNumber(item.stats.views)}}</text>
            <text>ğŸ’¬ {{item.stats.inquiries}}è¯¢ç›˜</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- å·¥å‚åˆ—è¡¨ -->
  <view class="factory-list" wx:if="{{factories.length > 0}}">
    <view class="section-title">
      <text>ğŸ­ ä¼˜è´¨å·¥å‚æ¨è</text>
      <text class="count">({{factories.length}}å®¶)</text>
    </view>

    <view class="factory-item card"
          wx:for="{{factories}}"
          wx:key="id"
          bindtap="goDetail"
          data-id="{{item.id}}">
      <!-- å·¥å‚åŸºæœ¬ä¿¡æ¯ -->
      <view class="factory-header">
        <view class="factory-main">
          <text class="factory-name">{{item.factory.name}}</text>
          <view class="factory-tags">
            <text class="tag">{{item.factory.scale}}</text>
            <text class="tag primary" wx:if="{{item.isHot}}">ğŸ”¥çˆ†æ¬¾</text>
          </view>
        </view>
        <view class="factory-score">
          <text class="score-label">å‡ºå£æ½œåŠ›</text>
          <text class="score-value">{{item.exportScore}}</text>
        </view>
      </view>

      <!-- è§†é¢‘å†…å®¹ -->
      <view class="factory-video" wx:if="{{item.video.coverImage}}">
        <image class="video-cover" src="{{item.video.coverImage}}" mode="aspectFill" />
        <view class="video-title">{{item.video.title}}</view>
      </view>

      <!-- å‡ºå£ä¿¡æ¯ -->
      <view class="factory-export">
        <text class="export-label">ğŸ“¤ å‡ºå£å›½å®¶ï¼š</text>
        <text class="export-countries">{{item.export.targetCountries.length}}ä¸ª</text>
        <text class="export-list">{{item.export.mainMarkets.slice(0,3).join('ã€')}}</text>
      </view>

      <!-- æ•°æ®ç»Ÿè®¡ -->
      <view class="factory-stats">
        <view class="stat-item">
          <text class="stat-value">{{formatNumber(item.stats.views)}}</text>
          <text class="stat-label">æ’­æ”¾</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{formatNumber(item.stats.followers)}}</text>
          <text class="stat-label">ç²‰ä¸</text>
        </view>
        <view class="stat-item highlight">
          <text class="stat-value">{{item.stats.inquiryCount}}</text>
          <text class="stat-label">è¯¢ç›˜</text>
        </view>
      </view>

      <!-- çˆ†æ¬¾äº§å“ -->
      <view class="factory-hot-product" wx:if="{{item.hotProduct}}">
        <text class="hot-label">ğŸ’ çˆ†æ¬¾ï¼š</text>
        <text class="hot-name">{{item.hotProduct.name}}</text>
        <text class="hot-price">{{item.hotProduct.price}}</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:if="{{!loading && factories.length === 0 && !currentIndustry}}">
    <text class="empty-icon">ğŸ­</text>
    <text class="empty-text">è¯·å…ˆé€‰æ‹©è¡Œä¸š</text>
    <text class="empty-hint">æœç´¢æ‚¨çš„è¡Œä¸šï¼ŒæŸ¥çœ‹å‡ºå£å¸‚åœºæƒ…å†µ</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- æ¯å‘¨æŠ¥å‘ŠæŒ‰é’® -->
  <view class="weekly-report-btn" bindtap="viewWeeklyReport" wx:if="{{currentIndustry}}">
    <text>ğŸ“Š æ¯å‘¨æŠ¥å‘Š</text>
  </view>
</view>
